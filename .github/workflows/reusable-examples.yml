env:
  ASTRO_TELEMETRY_DISABLED: 1
  DO_NOT_TRACK: "1"
  NEXT_TELEMETRY_DISABLED: "1"
  TURBO_TELEMETRY_DISABLED: "1"
jobs:
  bun-examples:
    name: ${{matrix.folder}}
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          allowed-endpoints: >
            api.github.com:443
            github.com:443
            objects.githubusercontent.com:443
            registry.npmjs.org:443
          disable-sudo-and-containers: true
          egress-policy: block
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: oven-sh/setup-bun@b7a1c7ccf290d58743029c4f6903da283811b979 # v2.1.0
        with:
          bun-version: 1.2.19
      - run: bun install
      - run: bun install
        working-directory: "examples/${{matrix.folder}}"
      - run: bun tsc --noEmit
        working-directory: "examples/${{matrix.folder}}"
    strategy:
      matrix:
        folder:
          - bun-rate-limit
  deno-examples:
    name: ${{matrix.folder}}
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          allowed-endpoints: >
            api.github.com:443
            deno.com:443
            github.com:443
            jsr.io:443
            objects.githubusercontent.com:443
            registry.npmjs.org:443
            release-assets.githubusercontent.com:443
          disable-sudo-and-containers: true
          egress-policy: block
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6.1.0
        with:
          node-version: 20
      - uses: denoland/setup-deno@bdaa2e4f849cbc8d7b46337cf37db0dc9b321074 # v2.0.3
        with:
          deno-version: v2.4.2
      - run: npm ci
      - run: deno install
        working-directory: "examples/${{matrix.folder}}"
      - run: deno check
        working-directory: "examples/${{matrix.folder}}"
    strategy:
      matrix:
        folder:
          - deno-sensitive-info
  node-examples:
    name: ${{matrix.folder}}
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
        with:
          allowed-endpoints: >
            api.github.com:443
            binaries.prisma.sh:443
            decide.arcjet.com:443
            fonts.googleapis.com:443
            fonts.gstatic.com:443
            github.com:443
            nodejs.org:443
            objects.githubusercontent.com:443
            raw.githubusercontent.com:443
            registry.npmjs.org:443
            release-assets.githubusercontent.com:443
            unpkg.com:443
          disable-sudo-and-containers: true
          egress-policy: block
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: actions/setup-node@395ad3262231945c25e8478fd5baf05154b1d79f # v6.1.0
        with:
          node-version: 20
      - run: npm ci
      - run: npm ci
        working-directory: "examples/${{matrix.folder}}"
      - env:
          # Astro integration checks for an `ARCJET_KEY`.
          ARCJET_KEY: ajkey_dummy
          # Used by Clerk examples: the smallest dummy token that passes the Clerk validation.
          NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: pk_test_LiQ=
        run: npm run build --if-present
        working-directory: "examples/${{matrix.folder}}"
      - run: npm run typecheck
        working-directory: "examples/${{matrix.folder}}"
    strategy:
      matrix:
        folder:
          - astro
          - express-bots
          - express-newman
          - express-rate-limit
          - express-sensitive-info
          - express-validate-email
          - fastify
          - nestjs
          - nextjs-14-nextauth-4
          - nextjs-app-dir-rate-limit
          - nextjs-app-dir-validate-email
          - nextjs-bot-categories
          - nextjs-decorate
          - nextjs-ip-details
          - nextjs-pages-wrap
          - nextjs-permit
          - nextjs-react-hook-form
          - nextjs-sensitive-info
          - nextjs-server-actions
          - nodejs-hono-rate-limit
          - nodejs-rate-limit
          - react-router-middleware
          - react-router
          - remix-express
          - sveltekit
name: Reusable examples workflow
# This workflow only uses the `workflow_call` event and no `concurrency`
# limit so those things can be managed by the caller.
on:
  - workflow_call
